function buildMap(e){this.map=new OpenLayers.Map(e,{controls:[]}),cache.mapDivId=e}function cityArea(e){this.map=e.map}function DistanceTool(e){this.map=e.map}function drawTool(e){this.map=e.map}function mapControl(e){this.map=e.map}function mapShape(e){this.map=e.map}function picLayer(e){this.map=e.map}buildMap.prototype={createMap:function(){var e=this.map,t=new OpenLayers.Layer.WMS("basicMap",mapStyle.wmsUrl,{layers:mapStyle.wmsName},{});mapStyle.mapDrag&&e.addControl(new OpenLayers.Control.Navigation({documentDrag:!0})),e.addLayer(t),e.setCenter(new OpenLayers.LonLat(mapStyle.mapLon,mapStyle.mapLat),mapStyle.mapZoom)},getMap:function(){return this.map}};var cache={mapDivId:""};cityArea.prototype={loadCity:function(e,t,a){this.featureType?(this.featureType=null,this.loadJsonDatas(e,"country")):"city"!==e&&this.loadJsonDatas(e,"city");var r=this.map.getLayersByName("areaLayers");r.length>0&&this.map.removeLayer(r);var n="";n=selectStyle.fontShow?new OpenLayers.Layer.Vector("areaLayers",{styleMap:new OpenLayers.StyleMap({"default":{fillColor:"${color}",label:"${areaname}",fillOpacity:mapStyle.fillOpacity,strokeColor:mapStyle.strokeColor,strokeWidth:mapStyle.strokeWidth,fontFamily:"宋体",fontSize:mapStyle.fontSize,fontColor:mapStyle.fontColor,labelOutlineWidth:mapStyle.labelOutlineWidth,labelOutlineColor:mapStyle.labelOutlineColor},select:{fillColor:selectStyle.fillColor,label:"${key}",fillOpacity:selectStyle.fillOpacity,strokeColor:selectStyle.strokeColor,strokeWidth:selectStyle.strokeWidth,cursor:selectStyle.cursor}})}):new OpenLayers.Layer.Vector("areaLayers",{styleMap:new OpenLayers.StyleMap({"default":{fillColor:"${color}",label:"${areaname}",fillOpacity:mapStyle.fillOpacity,strokeColor:mapStyle.strokeColor,strokeWidth:mapStyle.strokeWidth,fontFamily:"宋体",fontSize:mapStyle.fontSize,fontColor:mapStyle.fontColor,labelOutlineWidth:mapStyle.labelOutlineWidth,labelOutlineColor:mapStyle.labelOutlineColor},select:{fillColor:selectStyle.fillColor,label:"",fillOpacity:selectStyle.fillOpacity,strokeColor:selectStyle.strokeColor,strokeWidth:selectStyle.strokeWidth,cursor:selectStyle.cursor}})}),this.map.addLayers([n]);var o=new OpenLayers.Format.GeoJSON,i=this.areaJson;for(var l in i){var s=new Object({});if(s.key=i[l].name,s.type="area",s.areaname=mapStyle.fontShow?i[l].name:"",t)for(var y in t){if(t[y].name===s.key){s.color=t[y].color,selectStyle.defaultFont&&(s.areaname=t[y].name);break}s.color=mapStyle.fillColor}else s.color=mapStyle.fillColor;i[l].properties=s,console.info(i[l]),("undefined"==typeof a||i[l].name===a)&&(n.addFeatures(o.read(i[l])),this.areaLayer=n)}},loadCountry:function(e,t,a){this.featureType="country",this.loadCity(e,t,a)},load21City:function(e){var t=[],a=gd21City.features;for(var r in a)t.push(a[r]);this.areaJson=t,this.loadCity("city",e)},load86Country:function(e){var t=[],a=gd86Country.features;for(var r in a)t.push(a[r]);this.areaJson=t,this.loadCity("city",e)},load98Country:function(){},loadJsonDatas:function(e,t){var a=[],r=[],n=e.split(",");if("city"===t){r=gd21City.features;for(var o in r)for(var i in n)if(r[o].name===n[i]){a.push(r[o]);break}}else{r=gd86Country.features;for(var l in r)for(var s in n)r[l].parentName===n[s]&&a.push(r[l])}this.areaJson=a},addSelectEvent:function(e,t){var a=document.getElementById(cache.mapDivId),r=this.areaLayer;this.map.events.register("mousemove",this.map,function(e){var t=document.getElementById("showLayer");if(t){var r=t.offsetWidth,n=t.offsetHeight,o=a.offsetWidth,i=a.offsetHeight,l=a.offsetTop,s=a.offsetLeft,y=e.offsetY+l,p=e.offsetX+s;e.offsetX+r+10>o&&(p-=r+20),e.offsetY+n+10>i&&(y-=n+20),t.style.top=y+10+"px",t.style.left=p+10+"px"}});var n=r.features;for(var o in n)for(var i in e)e[i].name===n[o].attributes.key&&(n[o].attributes.html=e[i].content);var l=new OpenLayers.Control.SelectFeature([r],{hover:!0,multiple:!0,highlightOnly:selectStyle.highlightOnly,renderIntent:"select",onSelect:function(e){var t=e.attributes.html;t||(t="");var a=document.getElementById("showLayer");a&&a.parentNode.removeChild(a);var r=document.createElement("div");r.setAttribute("id","showLayer"),r.style.width="auto",r.style.height="auto",r.style.position="absolute",r.style.zIndex="999",r.innerHTML=t,document.getElementById(cache.mapDivId).appendChild(r)},onUnselect:function(e){document.getElementById("showLayer").style.display="none"},callbacks:{click:function(e){function a(){return t(e.attributes.key)}t&&a(t)}}});this.map.addControls([l]),l.activate()}},DistanceTool.prototype={addDistanceTool:function(){var e={label:"",strokeColor:"green",strokeOpacity:1,strokeWidth:2,pointRadius:6},t=new OpenLayers.Layer.Vector("Path",{styleMap:new OpenLayers.StyleMap({"default":{fillColor:"red",fillOpacity:"0.6",strokeColor:"green",strokeWidth:"2"}})}),a={line:new OpenLayers.Control.DrawFeature(t,OpenLayers.Handler.Path,{handlerOptions:e,featureAdded:function(e){console.info("finished")},callbacks:function(e){console.info(e)}})},r=a.line,n="",o="",i=0;r.handler.callbacks.point=function(e){if(""!==n){var t=OpenLayers.Util.distVincenty({lon:n,lat:o},{lon:e.x,lat:e.y});console.log(t+i),n=e.x,o=e.y,i+=t}else n=e.x,o=e.y},this.map.addControl(r),r.activate(),this.map.addLayer(t);var l=new(OpenLayers.Class(OpenLayers.Control,{initialize:function(e,t){OpenLayers.Control.prototype.initialize.apply(this,[t]),this.layer=e,this.handler=new OpenLayers.Handler.Feature(this,e,{dblclick:this.dbClickFeature,click:this.clickFeature})},dbClickFeature:function(e){console.info("dbClick")},clickFeature:function(e){console.info("click2")}}))(t);this.map.addControl(l),l.activate(),this.polygon=r},removeDistanceTool:function(){this.polygon&&this.polygon.deactivate()}},drawTool.prototype={drawPolygon:function(){var e={label:"",labelXOffset:"70",labelYOffset:"-12",strokeColor:"#FF0000",strokeOpacity:1,strokeWidth:2,fillColor:"#FF0000",fillOpacity:.5,pointRadius:6},t=new OpenLayers.Layer.Vector("Polygon",{styleMap:new OpenLayers.StyleMap({"default":{fillColor:"red",fillOpacity:"0.6",strokeColor:"blue",strokeWidth:"1"}})});this.initDraw(e,t,"Polygon"),this.polygonLayer=t},drawPath:function(){var e={label:"",strokeColor:"green",strokeOpacity:1,strokeWidth:2,pointRadius:6},t=new OpenLayers.Layer.Vector("Path",{styleMap:new OpenLayers.StyleMap({"default":{fillColor:"red",fillOpacity:"0.6",strokeColor:"green",strokeWidth:"2"}})});this.initDraw(e,t,"LineString"),this.pathLayer=t},drawPoint:function(){var e={strokeColor:"green",strokeOpacity:1,strokeWidth:2,labelXOffset:"70",labelYOffset:"-12",pointRadius:6,label:"${key}"},t=OpenLayers.Util.applyDefaults({graphicWidth:35,graphicHeight:46,graphicYOffset:-38,graphicOpacity:1,externalGraphic:"marker.png",strokeColor:"blue",strokeWidth:3,strokeOpacity:.5,label:"${getLabel}"},OpenLayers.Feature.Vector.style["default"]),a=OpenLayers.Util.applyDefaults({labelXOffset:70,labelYOffset:-12,pointRadius:6,label:"点击地图进行标记",strokeWidth:3,strokeColor:"red",graphicName:"square"},OpenLayers.Feature.Vector.style.temporary),r=new OpenLayers.StyleMap({"default":new OpenLayers.Style(t,{context:{getLabel:function(e){return e.attributes.key}}}),temporary:new OpenLayers.Style(a)}),n=new OpenLayers.Layer.Vector("Point",{styleMap:r});this.initDraw(e,n,"Point"),this.pointLayer=n},drawRegularPoygon:function(e){var t="";"triange"===e?t="3":"square"===e?t="4":"pentagon"===e?t="5":"hexagon"===e?t="6":"circle"===e&&(t="50");var a={fillColor:"red",fillOpacity:"0",strokeColor:"green",strokeOpacity:"0",strokeWidth:"0",label:"点击地图进行拖动",labelXOffset:"70",labelYOffset:"-12",sides:t,irregular:!0},r=new OpenLayers.Layer.Vector("RegularPolygon",{styleMap:new OpenLayers.StyleMap({"default":{fillColor:"red",fillOpacity:"0.6",strokeColor:"blue",strokeWidth:"1"}})});this.initDraw(a,r,"RegularPolygon"),this.regularPlygonLayer=r},initDraw:function(e,t,a){var r={point:new OpenLayers.Control.DrawFeature(t,OpenLayers.Handler.Point,{handlerOptions:e,featureAdded:function(e){console.info("finished"),e.attributes={key:"llllll"},n.handlerOptions.label="",i.activate(),l.deactivate();var t=new OpenLayers.LonLat(e.geometry.x,e.geometry.y),a=this.map.getPixelFromLonLat(t),r=document.createElement("div");r.setAttribute("id","pointText"),r.style.width="auto",r.style.height="auto",r.style.position="absolute",r.style.left=a.x,r.style.top=a.y+25,r.style.zIndex="999",r.innerHTML="<div>输入名称<input id='textVal' type='text'><input id='textSure' type='button' value='确定'/></div>",document.body.appendChild(r);var o=document.getElementById("textSure");o&&(o.onclick=function(){var t=document.getElementById("pointText");if(t){var a=document.getElementById("textVal").value;e.attributes={key:a},t.parentNode.removeChild(t)}})}}),line:new OpenLayers.Control.DrawFeature(t,OpenLayers.Handler.Path,{handlerOptions:e,featureAdded:function(e){console.info("finished"),n.handlerOptions.label="",i.activate(),l.deactivate()}}),polygon:new OpenLayers.Control.DrawFeature(t,OpenLayers.Handler.Polygon,{handlerOptions:e,featureAdded:function(e){console.info("finished"),n.handlerOptions.label="",i.activate(),l.deactivate()}}),RegularPolygon:new OpenLayers.Control.DrawFeature(t,OpenLayers.Handler.RegularPolygon,{handlerOptions:e,featureAdded:function(e){console.info("finished"),n.handlerOptions.label="",i.activate(),l.deactivate()}})},n="";"Polygon"===a?n=r.polygon:"LineString"===a?n=r.line:"Point"===a?n=r.point:"RegularPolygon"===a&&(n=r.RegularPolygon),n.handler.callbacks.point=function(e){console.log(e)},this.map.addControl(n),n.activate(),this.map.addControl(n),n.activate(),this.map.addLayer(t);var o="OpenLayers.Geometry."+a;"RegularPolygon"===a&&(o="OpenLayers.Geometry.Polygon");var i=new OpenLayers.Control.DragFeature(t,{geometryTypes:[o],onEnter:function(e){console.info("enter"),l.activate(),n.handlerOptions.label="双击删除"},onLeave:function(e){console.info("out"),n.handlerOptions.label=""}});this.map.addControl(i),i.activate();var l=new(OpenLayers.Class(OpenLayers.Control,{initialize:function(e,t){OpenLayers.Control.prototype.initialize.apply(this,[t]),this.layer=e,this.handler=new OpenLayers.Handler.Feature(this,e,{dblclick:this.dbClickFeature,click:this.clickFeature})},dbClickFeature:function(e){console.info("dbClick"),t.removeFeatures([e]),i.deactivate(),l.activate(),n.handlerOptions.label=""},clickFeature:function(e){console.info("click2")}}))(t);this.map.addControl(l),l.activate()},clearDraw:function(e){e?"point"===e?this.map.removeLayer(this.pointLayer):"path"===e?this.map.removeLayer(this.pathLayer):"plygon"===e?this.map.removeLayer(this.polygonLayer):"regularPlygon"===e&&this.map.removeLayer(this.regularPlygonLayer):(this.pointLayer&&this.map.removeLayer(this.pointLayer),this.pathLayer&&this.map.removeLayer(this.pathLayer),this.polygonLayer&&this.map.removeLayer(this.polygonLayer),this.regularPlygonLayer&&this.map.removeLayer(this.regularPlygonLayer))}},mapControl.prototype={addLoadingPanel:function(){this.map.addControl(new OpenLayers.Control.LoadingPanel)},addZoomBar:function(){this.map.addControl(new OpenLayers.Control.PanZoomBar)},addViewMap:function(){this.map.addControl(new OpenLayers.Control.OverviewMap)},addPosition:function(){this.map.addControl(new OpenLayers.Control.MousePosition)},addLayerSwitcher:function(){this.map.addControl(new OpenLayers.Control.LayerSwitcher)}},mapShape.prototype={addPoints:function(e){var t=new OpenLayers.Rule({filter:new OpenLayers.Filter.Function({evaluate:function(e){return e}}),symbolizer:{externalGraphic:"${imgPath}",label:"${text}",labelXOffset:"15",labelYOffset:"10",cursor:"pointer",graphicWidth:"${width}",graphicHeight:"${height}",graphicOpacity:1}}),a=new OpenLayers.Style;a.addRules([t]);var r=this.map.getLayersByName("player");r.length>0&&this.map.removeLayer(r);var n=new OpenLayers.Layer.Vector("player");n.styleMap=new OpenLayers.StyleMap(a),this.map.addLayer(n);var o=[];for(var i in e){var l=new OpenLayers.Geometry.Point(e[i].lon,e[i].lat),s=new OpenLayers.Feature.Vector(l),y=e[i].text;y||(y=""),s.attributes={imgPath:e[i].img,key:e[i].name,text:y,width:e[i].imgWidth,height:e[i].imgHeight,type:"point"},o.push(s)}n.addFeatures(o),this.pointLayer=n},addPointsEvent:function(e){var t=this.pointLayer;this.map.events.register("mousemove",this.map,function(e){var t=document.getElementById("showLayer");t&&(t.style.top=e.pageY+10,t.style.left=e.pageX+10)});var a=t.features;for(var r in a)for(var n in e)e[n].name===a[r].attributes.key&&(a[r].attributes.html=e[n].content);var o=new OpenLayers.Control.SelectFeature([t],{hover:!0,toggle:!0,onSelect:function(e){var a=e.attributes.html;a||(a="");var r=document.getElementById("showLayer");r&&r.parentNode.removeChild(r);var n=document.createElement("div");n.setAttribute("id","showLayer"),n.style.width="auto",n.style.height="auto",n.style.position="absolute",n.style.zIndex="999",n.innerHTML=a,document.body.appendChild(n),"point"===e.attributes.type&&pointSelectStyle.status&&(e.attributes.width=parseInt(e.attributes.width)+parseInt(15),e.attributes.height=parseInt(e.attributes.height)+parseInt(15),t.redraw())},onUnselect:function(e){"point"===e.attributes.type&&pointSelectStyle.status&&(e.attributes.width=parseInt(e.attributes.width)-parseInt(15),e.attributes.height=parseInt(e.attributes.height)-parseInt(15),t.redraw()),document.getElementById("showLayer").style.display="none"},callbacks:{click:function(e){console.info(e)}}});this.map.addControls([o]),o.activate()},addMarkers:function(e){var t=new OpenLayers.Layer.Markers("Markers");this.map.addLayer(t);for(var a in e){var r=new OpenLayers.Size(e[a].imgWidth,e[a].imgHeight),n=new OpenLayers.Pixel(-(r.w/2),-r.h),o=new OpenLayers.Icon(e[a].img,r,n);t.addMarker(new OpenLayers.Marker(new OpenLayers.LonLat(e[a].lon,e[a].lat),o))}this.markers=t},addMarkersEvent:function(e){}},picLayer.prototype={addWms:function(e,t,a){var r=(this.map.layers.length,new OpenLayers.Layer.WMS(e,t,a,{singleTile:!0,ratio:1,transparent:!0}));this.map.addLayer(r),this.picWms=r},setWmsZIndex:function(e){this.map.setLayerIndex(this.picWms,e)},refreshWms:function(e,t){this.map.getLayersByName(e)[0].mergeNewParams(t)},setWmsShow:function(e,t){this.map.getLayersByName(e)[0].setVisibility(t)},addImage:function(e){var t=this.map.getProjectionObject(),a=new OpenLayers.Bounds(110,20,120,30);a=a.transform("EPSG:4326",t);var r=new OpenLayers.Layer.Image("tempImage",e,a,a.getSize(),{transparent:!0,isBaseLayer:!1});this.map.addLayers([r]),picLayer.tempImage=r},showImage:function(){picLayer.tempImage.setVisibility(!0)},hideImage:function(){picLayer.tempImage.setVisibility(!1)},refreshImage:function(e){picLayer.tempImage.url=e,picLayer.tempImage.redraw()},animateImage:function(e,t){if(picLayer.animateModel){picLayer.lastIndex=t;var a=window.setTimeout(function(){picLayer.prototype.refreshImage(e[t]),picLayer.animateModel&&t===e.length-1&&(t=0),t<e.length-1&&picLayer.prototype.animateImage(e,t+1)},picLayer.animateTime);picLayer.animateControl=a}},startImageAnimate:function(e,t,a){picLayer.animateModel=a,picLayer.animateList=e,picLayer.animateTime=t,picLayer.prototype.animateImage(e,0)},stopImageAnimate:function(){"undefined"!=typeof picLayer.animateModel&&(picLayer.animateModel=!1)},goOnImageAnimate:function(){picLayer.animateModel=!0,picLayer.prototype.animateImage(picLayer.animateList,picLayer.lastIndex+1)},changeAnimateTime:function(e){picLayer.animateTime=e}};